"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[325],{157(e,r,t){t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>g});const n=JSON.parse('{"id":"Aggregator","title":"Aggregator Server","description":"Learn how the Aggregator Server acts as a gateway between clients and Seal MPC committee member key servers, aggregating encrypted partial key shares.","source":"@site/../content/Aggregator.mdx","sourceDirName":".","slug":"/Aggregator","permalink":"/Aggregator","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Aggregator Server","description":"Learn how the Aggregator Server acts as a gateway between clients and Seal MPC committee member key servers, aggregating encrypted partial key shares.","keywords":["aggregator server","Seal MPC","key server","committee members","encrypted signatures","DKG","API credentials","Lagrange interpolation"]},"sidebar":"docsSidebar","previous":{"title":"Key Server Operations for Committee Mode","permalink":"/KeyServerCommitteeOps"},"next":{"title":"Seal CLI","permalink":"/SealCLI"}}');var a=t(4848),s=t(8453);const i={title:"Aggregator Server",description:"Learn how the Aggregator Server acts as a gateway between clients and Seal MPC committee member key servers, aggregating encrypted partial key shares.",keywords:["aggregator server","Seal MPC","key server","committee members","encrypted signatures","DKG","API credentials","Lagrange interpolation"]},o="Aggregator Server",c={},g=[{value:"Overview",id:"overview",level:2},{value:"Setup",id:"setup",level:2},{value:"Initial setup (fresh DKG)",id:"initial-setup-fresh-dkg",level:3},{value:"Key rotation",id:"key-rotation",level:3},{value:"Running the server",id:"running-the-server",level:2},{value:"Running with Docker",id:"running-with-docker",level:3}];function l(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"aggregator-server",children:"Aggregator Server"})}),"\n",(0,a.jsx)(r.p,{children:"The Aggregator Server supports Seal MPC committees by acting as a gateway between clients and committee member key servers. It fetches encrypted partial key shares from committee members, verifies their encrypted signatures, aggregates the shares into a single encrypted key, and returns the result to the client. The aggregator authenticates to member key servers using private API keys."}),"\n",(0,a.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(r.p,{children:"The aggregator server performs the following tasks:"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsx)(r.li,{children:"Loads the committee's configuration from the network, including the threshold, member URLs, and partial public keys."}),"\n",(0,a.jsx)(r.li,{children:"Receives fetch key requests from clients."}),"\n",(0,a.jsx)(r.li,{children:"Fans out each request to committee member servers until it collects responses from enough members to satisfy the threshold."}),"\n",(0,a.jsx)(r.li,{children:"Verifies each encrypted signature using the corresponding partial public key."}),"\n",(0,a.jsx)(r.li,{children:"Aggregates the encrypted partial responses using Lagrange interpolation."}),"\n",(0,a.jsx)(r.li,{children:"Returns the aggregated encrypted key to the client."}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"setup",children:"Setup"}),"\n",(0,a.jsx)(r.p,{children:"The aggregator authenticates with each committee member's key server using private API keys."}),"\n",(0,a.jsx)(r.h3,{id:"initial-setup-fresh-dkg",children:"Initial setup (fresh DKG)"}),"\n",(0,a.jsx)(r.p,{children:"After a fresh DKG completes, the coordinator shares the following information with the aggregator operator:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Key server object ID"})," (",(0,a.jsx)(r.code,{children:"KEY_SERVER_OBJ_ID"}),"): The object ID created when the committee is finalized on-chain."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"API credentials for all committee members"}),", including:","\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"The on-chain server name"}),"\n",(0,a.jsx)(r.li,{children:"The API key name"}),"\n",(0,a.jsx)(r.li,{children:"The API key"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.p,{children:["The aggregator operator configures these values in ",(0,a.jsx)(r.code,{children:"aggregator-config.yaml"})," and then deploys the aggregator server."]}),"\n",(0,a.jsx)(r.h3,{id:"key-rotation",children:"Key rotation"}),"\n",(0,a.jsxs)(r.p,{children:["If new members join the committee during key rotation, the coordinator shares their API credentials with the aggregator operator. The aggregator operator adds the new credentials to ",(0,a.jsx)(r.code,{children:"aggregator-config.yaml"})," and restarts the server."]}),"\n",(0,a.jsx)(r.p,{children:"The aggregator configuration can include credentials for both old and new member names. The aggregator periodically reads the current committee state from the network and uses the latest on-chain member list to determine which credentials to use."}),"\n",(0,a.jsx)(r.h2,{id:"running-the-server",children:"Running the server"}),"\n",(0,a.jsxs)(r.p,{children:["Edit ",(0,a.jsx)(r.code,{children:"aggregator-config.yaml"})," to match your environment. Set the target network, the key server object ID provided by the coordinator, and the API credentials for all committee members:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-yaml",children:"# The network for the object.\nnetwork: !Testnet\n# The committee server object ID.\nkey_server_object_id: '0x0000000000000000000000000000000000000000000000000000000000000000'\n\n# API credentials for committee members.\napi_credentials:\n    server1: # on-chain server name\n      api_key_name: keyname1\n      api_key: key1\n    server2:\n      api_key_name: keyname2\n      api_key: key2\n"})}),"\n",(0,a.jsx)(r.p,{children:"Then run:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-shell",children:"CONFIG_PATH=crates/key-server/src/aggregator/aggregator-config.yaml cargo run --bin aggregator-server\n"})}),"\n",(0,a.jsx)(r.h3,{id:"running-with-docker",children:"Running with Docker"}),"\n",(0,a.jsx)(r.p,{children:"Build the image:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-shell",children:"docker build -f Dockerfile.aggregator -t aggregator-server:latest .\n"})}),"\n",(0,a.jsx)(r.p,{children:"Run the server:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-shell",children:"docker run -p 2024:2024 \\\n  -v $(pwd)/crates/key-server/src/aggregator/aggregator-config.yaml:/config/aggregator-config.yaml \\\n  -e CONFIG_PATH=/config/aggregator-config.yaml \\\n  aggregator-server\n"})})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453(e,r,t){t.d(r,{R:()=>i,x:()=>o});var n=t(6540);const a={},s=n.createContext(a);function i(e){const r=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);