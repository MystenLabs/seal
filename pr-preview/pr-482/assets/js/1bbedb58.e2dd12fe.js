"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[116],{1883(e,r,n){n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"KeyServerOps","title":"Key Server Operations for Independent Server Type","description":"Learn how to operate a Seal key server as an independent server type in Open or Permissioned mode as a service provider or for your own development and testing.","source":"@site/../content/KeyServerOps.mdx","sourceDirName":".","slug":"/KeyServerOps","permalink":"/KeyServerOps","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Key Server Operations for Independent Server Type","description":"Learn how to operate a Seal key server as an independent server type in Open or Permissioned mode as a service provider or for your own development and testing.","keywords":["key server operations","independent server type","committee server type","Open mode","Permissioned mode","master key","client registration","key export","key import","CORS configuration","infrastructure requirements"]},"sidebar":"docsSidebar","previous":{"title":"Security Best Practices and Risk Mitigations","permalink":"/SecurityBestPractices"},"next":{"title":"Key Server Operations for Committee Server Type","permalink":"/KeyServerCommitteeOps"}}');var i=n(2615),t=n(7545),o=n(7555);const c={title:"Key Server Operations for Independent Server Type",description:"Learn how to operate a Seal key server as an independent server type in Open or Permissioned mode as a service provider or for your own development and testing.",keywords:["key server operations","independent server type","committee server type","Open mode","Permissioned mode","master key","client registration","key export","key import","CORS configuration","infrastructure requirements"]},l="Key server operations for Independent server type",d={},a=[{value:"Network configuration",id:"network-configuration",level:2},{value:"Independent server type modes",id:"independent-server-type-modes",level:2},{value:"Open mode",id:"open-mode",level:2},{value:"Permissioned mode",id:"permissioned-mode",level:2},{value:"Register a client",id:"register-a-client",level:3},{value:"Export and import keys",id:"export-and-import-keys",level:3},{value:"Infrastructure requirements",id:"infrastructure-requirements",level:2},...o.RM];function h(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"key-server-operations-for-independent-server-type",children:"Key server operations for Independent server type"})}),"\n",(0,i.jsxs)(r.p,{children:["This guide covers how to set up and operate an ",(0,i.jsx)(r.strong,{children:"independent server type"})," key server. For an overview comparing committee and independent server types, see ",(0,i.jsx)(r.a,{href:"/ServerOverview",children:"Seal Server Overview"}),"."]}),"\n",(0,i.jsx)(r.p,{children:"Use this guide to operate a Seal key server in either of the following scenarios:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"As a service provider:"})," Run a key server as a service for developers."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"As a developer:"})," Run a key server for your own development and testing."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"network-configuration",children:"Network configuration"}),"\n",(0,i.jsxs)(r.p,{children:["Use the relevant package ID ",(0,i.jsx)(r.code,{children:"<SEAL_PACKAGE_ID>"})," to register your key server on the Sui network ",(0,i.jsx)(r.code,{children:"<NETWORK>"}),":"]}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Network"}),(0,i.jsx)(r.th,{children:"Package ID"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Testnet"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"0x927a54e9ae803f82ebf480136a9bcff45101ccbe28b13f433c89f5181069d682"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Mainnet"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"0xa212c4c6c7183b911d0be8768f4cb1df7a383025b5d0ba0c014009f0f30f5f8d"})})]})]})]}),"\n",(0,i.jsx)(r.h2,{id:"independent-server-type-modes",children:"Independent server type modes"}),"\n",(0,i.jsx)(r.p,{children:"When running an independent server, you can choose between Open or Permissioned mode:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Open mode"}),": In Open mode, the key server accepts decryption requests for any on-chain package. It uses a single master key to serve all access policies across packages. This mode is suitable for public or general-purpose deployments where package-level isolation is not required."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Permissioned mode"}),": In Permissioned mode, the key server restricts access to a manually approved list of packages associated with specific clients or applications. Each client is served using a dedicated master key.","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"This mode also supports importing or exporting the client-specific key if needed, for purposes such as disaster recovery or key server rotation."}),"\n",(0,i.jsxs)(r.li,{children:["The approved package ID for a client ",(0,i.jsx)(r.strong,{children:"must"})," be the package's ",(0,i.jsx)(r.strong,{children:"first published version"}),". This ensures that the key server continues to recognize the package after upgrades. You do not need to add new versions of the package to a client's allowlist."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:["You can choose the option that best fits your deployment model and security requirements. The following sections provide more details on both options. Also see ",(0,i.jsx)(r.a,{href:"/SealCLI",children:"Seal CLI"})," for reference."]}),"\n",(0,i.jsx)(r.h2,{id:"open-mode",children:"Open mode"}),"\n",(0,i.jsx)(r.p,{children:"In Open mode, the key server allows decryption requests for Seal policies from any package. This mode is ideal for testing or for deployments where the key server is operated as a best-effort service without direct user liability."}),"\n",(0,i.jsx)(r.p,{children:"Before starting the key server, you must generate a BLS master key pair. This command outputs both the master secret key and the public key."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"cargo run --bin seal-cli genkey\nMaster key: <MASTER_KEY>\nPublic key: <MASTER_PUBKEY>\n"})}),"\n",(0,i.jsxs)(r.p,{children:["To make the key server discoverable by Seal clients, register it on-chain.\nCall the ",(0,i.jsx)(r.code,{children:"create_and_transfer_v1"})," function from the ",(0,i.jsx)(r.code,{children:"seal::key_server"})," module like the following:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"sui client switch --env <NETWORK>\nsui client active-address # fund this if necessary\nsui client call --function create_and_transfer_v1 --module key_server --package <SEAL_PACKAGE_ID> --args <YOUR_SERVER_NAME> https://<YOUR_URL> 0 <MASTER_PUBKEY>\n\n# outputs object of type key_server::KeyServer <KEY_SERVER_OBJECT_ID> (may output additional objects)\n"})}),"\n",(0,i.jsxs)(r.p,{children:["To start the key server in Open mode, run the command ",(0,i.jsx)(r.code,{children:"cargo run --bin key-server"}),", but before running the server, set the following environment variables:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"MASTER_KEY"}),": The master secret key generated using the ",(0,i.jsx)(r.code,{children:"seal-cli"})," tool."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"CONFIG_PATH"}),": The path to a .yaml configuration file that specifies key server settings. For the configuration file format, see the ",(0,i.jsx)(r.a,{href:"https://github.com/MystenLabs/seal/tree/main/crates/key-server/key-server-config.yaml",children:"example config"}),"."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"In the config file, make sure to:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Set the network, for example, ",(0,i.jsx)(r.code,{children:"Testnet"}),", ",(0,i.jsx)(r.code,{children:"Mainnet"}),", or ",(0,i.jsx)(r.code,{children:"!Custom"})," for custom RPC endpoints.","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["For ",(0,i.jsx)(r.code,{children:"!Custom"})," network, you can either specify ",(0,i.jsx)(r.code,{children:"node_url"})," in the config or set the ",(0,i.jsx)(r.code,{children:"NODE_URL"})," environment variable."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["Set the mode to ",(0,i.jsx)(r.code,{children:"!Open"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:["Set the ",(0,i.jsx)(r.code,{children:"key_server_object_id"})," field to ",(0,i.jsx)(r.code,{children:"<KEY_SERVER_OBJECT_ID>"}),", the ID of the key server object you registered on-chain."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"CONFIG_PATH=crates/key-server/key-server-config.yaml MASTER_KEY=<MASTER_KEY> cargo run --bin key-server\n\n# Or with a custom RPC endpoint via environment variable:\n# NODE_URL=https://your-custom-rpc.example.com CONFIG_PATH=crates/key-server/key-server-config.yaml MASTER_KEY=<MASTER_KEY> cargo run --bin key-server\n"})}),"\n",(0,i.jsx)(r.p,{children:"Alternatively, run with Docker:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"docker build -t seal-key-server . --build-arg GIT_REVISION=\"$(git describe --always --abbrev=12 --dirty --exclude '*')\" \n\ndocker run -p 2024:2024 -v $(pwd)/crates/key-server/key-server-config.yaml:/config/key-server-config.yaml \\\n  -e CONFIG_PATH=/config/key-server-config.yaml \\\n   -e MASTER_KEY=<MASTER_KEY> \\\n   seal-key-server\n"})}),"\n",(0,i.jsx)(r.h2,{id:"permissioned-mode",children:"Permissioned mode"}),"\n",(0,i.jsx)(r.p,{children:"In Permissioned mode, the key server only allows decryption requests for Seal policies from explicitly allowlisted packages. This is the recommended mode for B2B deployments where tighter access control and client-specific key separation are required."}),"\n",(0,i.jsxs)(r.p,{children:["Start by generating a master seed for the key server. Use the ",(0,i.jsx)(r.code,{children:"seal-cli"})," tool as ",(0,i.jsx)(r.code,{children:"cargo run --bin seal-cli gen-seed"}),". This command outputs the secret master seed which should be stored securely."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"cargo run --bin seal-cli gen-seed\nSeed: <MASTER_SEED>\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Next, create a configuration file in ",(0,i.jsx)(r.code,{children:".yaml"})," format following the instructions in the ",(0,i.jsx)(r.a,{href:"https://github.com/MystenLabs/seal/tree/main/crates/key-server/key-server-config.yaml",children:"example configuration"})," and with the following properties:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Set the mode to ",(0,i.jsx)(r.code,{children:"!Permissioned"}),"."]}),"\n",(0,i.jsx)(r.li,{children:"Initialize with empty client configurations (clients can be added later)."}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"  server_mode: !Permissioned\n    client_configs:\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Set the environment variable ",(0,i.jsx)(r.code,{children:"MASTER_KEY"})," to the master secret seed generated by the ",(0,i.jsx)(r.code,{children:"seal-cli"})," tool, and the environment variable ",(0,i.jsx)(r.code,{children:"CONFIG_PATH"})," pointing to a .yaml configuration file. Run the server using ",(0,i.jsx)(r.code,{children:"cargo run --bin key-server"}),". It should abort after printing a list of unassigned derived public keys (search for logs with the text ",(0,i.jsx)(r.code,{children:"Unassigned derived public key"}),")."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"# MASTER_KEY=<MASTER_SEED> CONFIG_PATH=crates/key-server/key-server-config.yaml cargo run --bin key-server \n\nMASTER_KEY=0x680d7268095510940a3cce0d0cfdbd82b3422f776e6da46c90eb36f25ce2b30e CONFIG_PATH=crates/key-server/key-server-config.yaml cargo run --bin key-server \n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:'2025-06-15T02:02:56.303459Z  INFO key_server: Unassigned derived public key with index 0: "<PUBKEY_0>"\n2025-06-15T02:02:56.303957Z  INFO key_server: Unassigned derived public key with index 1: "<PUBKEY_1>"\n2025-06-15T02:02:56.304418Z  INFO key_server: Unassigned derived public key with index 2: "<PUBKEY_2>"\n'})}),"\n",(0,i.jsx)(r.p,{children:"Each supported client must have a registered on-chain key server object to enable discovery and policy validation."}),"\n",(0,i.jsx)(r.h3,{id:"register-a-client",children:"Register a client"}),"\n",(0,i.jsx)(r.p,{children:"Follow these steps to add every new client to a Permissioned key server:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["The client sends the key server provider a list of Seal policy package IDs to allow on the key server (for example, ",(0,i.jsx)(r.code,{children:"<POLICY_PACKAGE_ID_0>"}),", ",(0,i.jsx)(r.code,{children:"<POLICY_PACKAGE_ID_1>"}),")."]}),"\n",(0,i.jsxs)(r.li,{children:["The key server provider registers a new key server on-chain by calling ",(0,i.jsx)(r.code,{children:"seal::key_server::create_and_transfer_v1"})," with an ",(0,i.jsx)(r.strong,{children:"unassigned derived public key"}),".","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Copy an unassigned derived public key from the server logs (see preceding section). Use the next available derivation index (for the first client, ",(0,i.jsx)(r.code,{children:"0"}),"; for the nth client, ",(0,i.jsx)(r.code,{children:"n-1"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Index"}),(0,i.jsx)(r.th,{children:"Derived Public Key"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"0"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"<PUBKEY_0>"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"1"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"<PUBKEY_1>"})})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"<INDEX>"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"<PUBKEY_<INDEX>>"})})]})]})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"# The 0 between the key server URL and public key arguments is a fixed or static value for all client registrations\n\nsui client call --function create_and_transfer_v1 --module key_server --package <SEAL_PACKAGE_ID> --args <YOUR_SERVER_NAME> https://<YOUR_URL> 0 <PUBKEY_<INDEX>>\n\n# outputs object of type key_server::KeyServer <KEY_SERVER_OBJECT_ID_<INDEX>> (may output additional objects)\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Add an entry in config file:","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Set ",(0,i.jsx)(r.code,{children:"client_master_key"})," to type ",(0,i.jsx)(r.code,{children:"Derived"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:["Set ",(0,i.jsx)(r.code,{children:"derivation_index"})," as ",(0,i.jsx)(r.code,{children:"<INDEX>"})," (use ",(0,i.jsx)(r.code,{children:"0"})," for the first client; for the nth client, use ",(0,i.jsx)(r.code,{children:"n-1"}),")."]}),"\n",(0,i.jsxs)(r.li,{children:["Set ",(0,i.jsx)(r.code,{children:"key_server_object_id"})," to the value ",(0,i.jsx)(r.code,{children:"<KEY_SERVER_OBJECT_ID_<INDEX>>"})," from the registration output in the preceding section."]}),"\n",(0,i.jsxs)(r.li,{children:["Include the list of Seal policy packages IDs that the client provided, under ",(0,i.jsx)(r.code,{children:"package_ids"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.admonition,{type:"info",children:(0,i.jsxs)(r.p,{children:["You can map multiple different packages from a developer to the same client (for example, for different features or apps). However, if the developer later decides to ",(0,i.jsx)(r.a,{href:"#export-and-import-keys",children:"export the client key"}),", access will be revoked for ",(0,i.jsx)(r.strong,{children:"all"})," packages mapped to that client. Confirm whether they prefer separate client per package (allowing for granular revocation) or a single consolidated client (allowing for simpler operations)."]})}),"\n",(0,i.jsx)(r.admonition,{type:"info",children:(0,i.jsxs)(r.p,{children:["When adding a package for a feature or app, you must add the package ID of the package's ",(0,i.jsx)(r.strong,{children:"first published version"}),". This ensures that the key server continues to recognize the package after upgrades. You do not need to add new versions of a package to a client's allowlist."]})}),"\n",(0,i.jsx)(r.p,{children:"For example:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:'    - name: "alice" # not used in code, identifier for your own information\n      client_master_key: !Derived\n        derivation_index: <INDEX>\n      key_server_object_id: "<KEY_SERVER_OBJECT_ID_<INDEX>>"\n      package_ids:\n        - "<POLICY_PACKAGE_ID_1>"\n        - "<POLICY_PACKAGE_ID_2>"\n'})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Restart the key server to apply the config changes."}),"\n",(0,i.jsxs)(r.li,{children:["Share the new key server object ID ",(0,i.jsx)(r.code,{children:"<KEY_SERVER_OBJECT_ID_<INDEX>>"})," with the client."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"MASTER_KEY=<MASTER_SEED> CONFIG_PATH=crates/key-server/key-server-config.yaml cargo run --bin key-server \n"})}),"\n",(0,i.jsx)(r.p,{children:"Or with Docker:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"docker run -p 2024:2024 \\\n  -v $(pwd)/crates/key-server/key-server-config.yaml:/config/key-server-config.yaml \\\n  -e CONFIG_PATH=/config/key-server-config.yaml \\\n  -e MASTER_KEY=<MASTER_SEED> \\\n  seal-key-server\n"})}),"\n",(0,i.jsxs)(r.p,{children:["To add another client in the future, repeat the preceding steps. Register a new unassigned derived public key on-chain, note the returned ",(0,i.jsx)(r.code,{children:"key_server_object_id"}),", add a config entry with the next ",(0,i.jsx)(r.code,{children:"derivation_index"})," and the client's ",(0,i.jsx)(r.code,{children:"package_ids"}),", then restart the server. The logs show the next unassigned indices and public keys."]}),"\n",(0,i.jsx)(r.h3,{id:"export-and-import-keys",children:"Export and import keys"}),"\n",(0,i.jsx)(r.p,{children:"In rare cases where you need to export a client key:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Use the ",(0,i.jsx)(r.code,{children:"seal-cli"})," tool as ",(0,i.jsx)(r.code,{children:"cargo run --bin seal-cli derive-key --seed $MASTER_SEED --index X"}),". Replace ",(0,i.jsx)(r.code,{children:"X"})," with the ",(0,i.jsx)(r.code,{children:"derivation_index"})," of the key you want to export. The tool outputs the corresponding master key, which can be imported by another key server if needed."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Here's an example command assuming the key server owner is exporting the key at index 0:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"cargo run --bin seal-cli derive-key --seed <MASTER_SEED> --index 0\n\nMaster key: <CLIENT_MASTER_KEY>\nPublic key: <CLIENT_MASTER_PUBKEY>\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Disable this key on the current server:","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Change the client's ",(0,i.jsx)(r.code,{children:"client_master_key"})," type to ",(0,i.jsx)(r.code,{children:"Exported"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:["Set the ",(0,i.jsx)(r.code,{children:"deprecated_derivation_index"})," field with the derivation index."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"For example:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:'     - name: "bob"\n       client_master_key: !Exported\n         deprecated_derivation_index: 0\n'})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"To import a client master key into a different key server, first transfer the existing key server object to the target server's owner. After completing the transfer, the new owner should update the object's URL to point to their key server."}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:["Here's an example Sui CLI command assuming the export of ",(0,i.jsx)(r.code,{children:"<KEY_SERVER_OBJECT_ID_0>"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"sui transfer --object-id <KEY_SERVER_OBJECT_ID_0> --to <NEW_OWNER_ADDRESS>\n"})}),"\n",(0,i.jsxs)(r.p,{children:["The owner of ",(0,i.jsx)(r.code,{children:"<NEW_OWNER_ADDRESS>"})," can now run:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"sui client call --function update --module key_server --package <SEAL_PACKAGE_ID> --args <KEY_SERVER_OBJECT_ID_0> https://<NEW_URL>\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["The new key server owner can now add it to their config file:","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"client_master_key"})," set to type ",(0,i.jsx)(r.code,{children:"Imported"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:["The name of the environment variable containing the key, for example, ",(0,i.jsx)(r.code,{children:"BOB_BLS_KEY"}),". This name is used later."]}),"\n",(0,i.jsxs)(r.li,{children:["The key server object registered on-chain for this client earlier, for example, ",(0,i.jsx)(r.code,{children:"<KEY_SERVER_OBJECT_ID_0>"}),"."]}),"\n",(0,i.jsx)(r.li,{children:"The list of packages associated with the client."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"For example:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:'     - name: "bob"\n       client_master_key: !Imported\n         env_var: "BOB_BLS_KEY"\n       key_server_object_id: "<KEY_SERVER_OBJECT_ID_0>"\n       package_ids:\n         - "<POLICY_PACKAGE_ID>"\n'})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Run the key server using the client master key as the configured environment variable."}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"CONFIG_PATH=crates/key-server/key-server-config.yaml BOB_BLS_KEY=<CLIENT_MASTER_KEY> MASTER_KEY=<MASTER_SEED> cargo run --bin key-server\n"})}),"\n",(0,i.jsx)(r.p,{children:"Or run with Docker:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-shell",children:"docker run -p 2024:2024 \\\n  -v $(pwd)/crates/key-server/key-server-config.yaml:/config/key-server-config.yaml \\\n  -e CONFIG_PATH=/config/key-server-config.yaml \\\n  -e BOB_BLS_KEY=<CLIENT_MASTER_KEY> \\\n  -e MASTER_KEY=<MASTER_SEED> \\\n  seal-key-server\n"})}),"\n",(0,i.jsx)(r.h2,{id:"infrastructure-requirements",children:"Infrastructure requirements"}),"\n",(0,i.jsx)(r.p,{children:"The server is initialized with a master key (or seed), which must be kept secure. You can store this key using a cloud-based Key Management System (KMS), or in a self-managed software or hardware vault. If you're importing keys, those should be protected using the same secure storage approach."}),"\n",(0,i.jsx)(o.Ay,{})]})}function p(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},7555(e,r,n){n.d(r,{Ay:()=>c,RM:()=>t});var s=n(2615),i=n(7545);const t=[{value:"CORS configuration",id:"cors-configuration",level:3}];function o(e){const r={a:"a",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.p,{children:["The server is a lightweight, stateless service designed for easy horizontal scaling. Because it doesn't require persistent storage, you can run multiple instances behind a load balancer to increase availability and resilience. Each instance must have access to a trusted ",(0,s.jsx)(r.a,{href:"https://docs.sui.io/guides/operator/sui-full-node",children:"Sui full node"})," \u2014 ideally one that's geographically close to reduce latency during policy checks and key operations."]}),"\n",(0,s.jsx)(r.p,{children:"To operate the server securely, it is recommended to place it behind an API gateway or reverse proxy. This allows you to:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Expose the service over HTTPS and terminate SSL/TLS at the edge"}),"\n",(0,s.jsx)(r.li,{children:"Enforce rate limiting and prevent abuse"}),"\n",(0,s.jsx)(r.li,{children:"Authenticate requests using API keys or access tokens"}),"\n",(0,s.jsx)(r.li,{children:"Optionally integrate usage tracking for commercial or billable offerings, such as logging access frequency per client or package"}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["For observability, the server exposes Prometheus-compatible metrics on port ",(0,s.jsx)(r.code,{children:"9184"}),". You can access raw metrics by running ",(0,s.jsx)(r.code,{children:"curl http://0.0.0.0:9184"}),". These metrics can also be visualized using tools like Grafana. The key server also includes a basic health check endpoint on port ",(0,s.jsx)(r.code,{children:"2024"}),": ",(0,s.jsx)(r.code,{children:"curl http://0.0.0.0:2024/health"}),"."]}),"\n",(0,s.jsx)(r.h3,{id:"cors-configuration",children:"CORS configuration"}),"\n",(0,s.jsx)(r.p,{children:"Configure Cross-Origin Resource Sharing (CORS) on your server to allow applications to make requests directly from the browser. Use the following recommended headers:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-shell",children:"Access-Control-Allow-Origin: *\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Allow-Headers: Request-Id, Client-Sdk-Type, Client-Sdk-Version\nAccess-Control-Expose-Headers: x-keyserver-version\n"})}),"\n",(0,s.jsxs)(r.p,{children:["If your server requires an API key, make sure to include the corresponding HTTP header name in ",(0,s.jsx)(r.code,{children:"Access-Control-Allow-Headers"})," as well."]})]})}function c(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},7545(e,r,n){n.d(r,{R:()=>o,x:()=>c});var s=n(9471);const i={},t=s.createContext(i);function o(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);