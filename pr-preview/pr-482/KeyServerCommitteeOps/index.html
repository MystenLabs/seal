<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-KeyServerCommitteeOps" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Key Server Operations for Committee Server Type | Seal Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://MystenLabs.github.io/seal/pr-preview/pr-482/KeyServerCommitteeOps"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Key Server Operations for Committee Server Type | Seal Documentation"><meta data-rh="true" name="description" content="Learn how to set up and operate a key server as a committee server type, including DKG ceremonies, key rotation, and aggregator configuration."><meta data-rh="true" property="og:description" content="Learn how to set up and operate a key server as a committee server type, including DKG ceremonies, key rotation, and aggregator configuration."><meta data-rh="true" name="keywords" content="key server operations,committee mode,DKG,distributed key generation,key rotation,aggregator server,MPC committee,coordinator,committee members"><link data-rh="true" rel="icon" href="/seal/pr-preview/pr-482/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://MystenLabs.github.io/seal/pr-preview/pr-482/KeyServerCommitteeOps"><link data-rh="true" rel="alternate" href="https://MystenLabs.github.io/seal/pr-preview/pr-482/KeyServerCommitteeOps" hreflang="en"><link data-rh="true" rel="alternate" href="https://MystenLabs.github.io/seal/pr-preview/pr-482/KeyServerCommitteeOps" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Key Server Operations for Committee Server Type","item":"https://MystenLabs.github.io/seal/pr-preview/pr-482/KeyServerCommitteeOps"}]}</script><script>window.__COPY_PAGE_BUTTON_OPTIONS__={customStyles:{},enabledActions:["copy","view","chatgpt","claude"],id:"default"}</script>
<link key="docusaurus-plugin-plausible-preconnect" rel="preconnect" href="https://plausible.io">
<script key="docusaurus-plugin-plausible-script" async defer="defer" data-domain="https://seal-docs.wal.app" src="https://plausible.io/js/plausible.js"></script>
<script key="docusaurus-plugin-plausible-custom-events">window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script>
<meta name="algolia-site-verification" content="BCA21DA2879818D2"><link rel="stylesheet" href="/seal/pr-preview/pr-482/assets/css/styles.05dc90f7.css">
<script src="/seal/pr-preview/pr-482/assets/js/runtime~main.1ad2478c.js" defer="defer"></script>
<script src="/seal/pr-preview/pr-482/assets/js/main.19e42edb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/seal/pr-preview/pr-482/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_LviR" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/seal/pr-preview/pr-482/"><div class="navbar__logo"><img src="/seal/pr-preview/pr-482/img/logo.svg" alt="Seal Logo" class="themedComponent_Kol1 themedComponent--light_kufX"><img src="/seal/pr-preview/pr-482/img/logo.svg" alt="Seal Logo" class="themedComponent_Kol1 themedComponent--dark_hrfE"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/MystenLabs/seal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_kAk_"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_Rl5H colorModeToggle_AwaA"><button class="clean-btn toggleButton_QYOY toggleButtonDisabled_JK9z" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_nbo7 lightToggleIcon_wavo"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_nbo7 darkToggleIcon_ZV6J"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_nbo7 systemToggleIcon_mxAQ"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer__cgi"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_D5Wb"><div class="docsWrapper_STMn"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_uE2c" type="button"></button><div class="docRoot_w8jp"><aside class="theme-doc-sidebar-container docSidebarContainer_sB7m"><div class="sidebarViewport_xaHd"><div class="sidebar_t5dI"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_xw2o"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/seal/pr-preview/pr-482/"><span title="What is Seal?" class="linkLabel_qxzL">What is Seal?</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/seal/pr-preview/pr-482/GettingStarted"><span title="Getting Started" class="linkLabel_qxzL">Getting Started</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/seal/pr-preview/pr-482/ServerOverview"><span title="Seal Server Overview" class="linkLabel_qxzL">Seal Server Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink__Ear menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/seal/pr-preview/pr-482/Design"><span title="Developer Guide" class="categoryLinkLabel_Q_Zz">Developer Guide</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink__Ear menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/seal/pr-preview/pr-482/KeyServerOps"><span title="Operator Guide" class="categoryLinkLabel_Q_Zz">Operator Guide</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seal/pr-preview/pr-482/KeyServerOps"><span title="Key Server Operations for Independent Server Type" class="linkLabel_qxzL">Key Server Operations for Independent Server Type</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/seal/pr-preview/pr-482/KeyServerCommitteeOps"><span title="Key Server Operations for Committee Server Type" class="linkLabel_qxzL">Key Server Operations for Committee Server Type</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seal/pr-preview/pr-482/Aggregator"><span title="Aggregator Server" class="linkLabel_qxzL">Aggregator Server</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seal/pr-preview/pr-482/SealCLI"><span title="Seal CLI" class="linkLabel_qxzL">Seal CLI</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/seal/pr-preview/pr-482/Pricing"><span title="Seal Pricing" class="linkLabel_qxzL">Seal Pricing</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/seal/pr-preview/pr-482/TermsOfService"><span title="Seal Terms of Service" class="linkLabel_qxzL">Seal Terms of Service</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_QMuH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hrAY"><div class="docItemContainer_o2cG"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_TJli" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/seal/pr-preview/pr-482/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_neYB"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Operator Guide</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Key Server Operations for Committee Server Type</span></li></ul></nav><div class="tocCollapsible_YlOF theme-doc-toc-mobile tocMobile_qAHm"><button type="button" class="clean-btn tocCollapsibleButton_OlXN">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Key Server Operations for Committee Server Type</h1></header><p>This guide explains how to set up and operate a key server as a committee server type. For an overview of committee vs independent server types, see <a class="" href="/seal/pr-preview/pr-482/ServerOverview">Seal Server Overview</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_V57r" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>Committee server type embeds distributed key trust directly into the infrastructure layer. To your application, it looks like a single logical key server. Internally, it enforces threshold cryptography across multiple independent operators.</p>
<p>Anyone can set up a committee — there is no central authority or permission required. Operators participate in a Distributed Key Generation (DKG) ceremony that produces distributed key shares. Each operator runs a key server that holds only its partial share. No single operator ever holds the full master key.</p>
<p>In addition to the committee member key servers, an <strong><a class="" href="/seal/pr-preview/pr-482/Aggregator">aggregator server</a></strong> is required. The aggregator collects encrypted partial responses from operators and combines them into a single encrypted result for clients. Because the aggregator is trustless and holds no key material, it can be operated by anyone, including a third party.</p>
<p><strong>What you&#x27;ll learn:</strong></p>
<ul>
<li class="">How to run a fresh DKG to bootstrap a new committee and generate the initial key shares</li>
<li class="">How to configure and start a key server for a committee member</li>
<li class="">How to perform coordinated rotation ceremonies to update membership while preserving the same public key and object ID</li>
<li class="">How to update a running key server to use the new key share after rotation</li>
</ul>
<p><strong>How DKG works:</strong></p>
<p>The DKG process involves two roles: a <strong>coordinator</strong> that orchestrates the workflow, and <strong>committee members</strong> that participate in key generation and rotation. Both fresh DKG and key rotation follow the same three-phase process:</p>
<ul>
<li class=""><strong>Phase A — Registration:</strong> Members generate encryption keys and register them on-chain</li>
<li class=""><strong>Phase B — Message creation:</strong> Members create and exchange DKG messages off-chain</li>
<li class=""><strong>Phase C — Finalization:</strong> Members process messages and propose the committee configuration on-chain</li>
</ul>
<p>The coordinator signals members when to move from one phase to the next.</p>
<p><strong>Guide organization:</strong></p>
<ul>
<li class="">Fresh DKG coordinator runbook</li>
<li class="">Fresh DKG member runbook (includes key server setup)</li>
<li class="">Key rotation coordinator runbook</li>
<li class="">Key rotation member runbook (includes key server configuration updates)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_V57r" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h2>
<p>Before running the DKG or key rotation workflows, both the coordinator and all committee members must complete the following steps.</p>
<ol>
<li class="">
<p>Establish a trusted communication channel (e.g. group chat, email) with all other participants. This channel is used for the coordinator and members to share files at certain steps of the workflow, for the coordinator to announce phase transitions, and to verify each other&#x27;s on-chain addresses. Address verification can also happen on-chain (for example, via a governance action).</p>
</li>
<li class="">
<p>Install Sui by following the <a href="https://docs.sui.io/guides/developer/getting-started/sui-install" target="_blank" rel="noopener noreferrer" class="">official installation guide</a>.</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">sui --version</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">Make sure you have a CLI wallet ready on the expected network with gas. This is the address you will use throughout the rest of the workflows, and the one you should share with the group for verification.</li>
</ol>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client gas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># to create new wallet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client new-address ed25519</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># switch if needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client switch --env testnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client switch --address 0x...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># to fund wallet gas on testnet: faucet.sui.io</span><br></span></code></pre></div></div>
<ol start="4">
<li class="">Clone the <a href="https://github.com/MystenLabs/seal" target="_blank" rel="noopener noreferrer" class="">Seal repository</a> and set it as your working directory.</li>
</ol>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/MystenLabs/seal.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd seal</span><br></span></code></pre></div></div>
<ol start="5">
<li class="">Build the seal-committee-cli tool.</li>
</ol>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- --help</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_V57r" id="fresh-dkg-process">Fresh DKG process<a href="#fresh-dkg-process" class="hash-link" aria-label="Direct link to Fresh DKG process" title="Direct link to Fresh DKG process" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_V57r" id="fresh-dkg-coordinator-runbook">Fresh DKG coordinator runbook<a href="#fresh-dkg-coordinator-runbook" class="hash-link" aria-label="Direct link to Fresh DKG coordinator runbook" title="Direct link to Fresh DKG coordinator runbook" translate="no">​</a></h3>
<p>Follow these steps to initialize a new MPC committee using a fresh DKG.</p>
<ol>
<li class=""><strong>Prepare DKG configuration</strong></li>
</ol>
<p>a. Make sure your CLI has the expected network and active address with gas.</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># switch if needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client switch --env testnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client switch --address 0x...</span><br></span></code></pre></div></div>
<p>b. Create a clean working directory named <code>dkg-state</code> and copy the example configuration file:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain"># in seal/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf dkg-state &amp;&amp; mkdir dkg-state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp crates/seal-committee-cli/dkg.example.yaml dkg-state/dkg.yaml</span><br></span></code></pre></div></div>
<p>c. Collect the on-chain addresses of all participating members. Then open <code>dkg-state/dkg.yaml</code> and update the following fields:</p>
<div class="language-yaml codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-yaml codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">init-params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">NETWORK</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Testnet </span><span class="token comment" style="color:#999988;font-style:italic"># Target network</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">THRESHOLD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Committee threshold (t of n)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">MEMBERS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Addresses of all participating members</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 0x</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 0x</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 0x</span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre></div></div>
<ol start="2">
<li class=""><strong>Publish and initialize the committee</strong></li>
</ol>
<p>Run the publish-and-init command:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- publish-and-init</span><br></span></code></pre></div></div>
<p>This command:</p>
<ul>
<li class="">Publishes the <code>seal_committee</code> package onchain with upgrade capability</li>
<li class="">Extracts the InitCap and UpgradeCap from the publish transaction</li>
<li class="">Initializes the committee state and attaches the UpgradeManager (which holds the UpgradeCap) to the committee</li>
<li class="">Appends the committee identifiers to <code>dkg.yaml</code></li>
</ul>
<p>For example:</p>
<div class="language-yaml codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-yaml codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">publish-and-init</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">COMMITTEE_PKG</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x5b788ac96879a752afbd3608a202207d75cf0f03387bcb744bfb4930cc544a70</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">COMMITTEE_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x55241859c52f51dd149763769b8aa1e54de39b55acacda3f3a67629691247985</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">COORDINATOR_ADDRESS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xef91ea73b4423e3a6176b0a1c9c6e4619de45c9c4e7c0b4aae358e292707d8c2</span><br></span></code></pre></div></div>
<ol start="3">
<li class=""><strong>Distribute configuration and notify Phase A (Registration)</strong></li>
</ol>
<p>Share the updated <code>dkg.yaml</code> file with all committee members. Notify members to begin <strong>Phase A (Registration)</strong>.</p>
<ol start="4">
<li class=""><strong>Monitor member registration</strong></li>
</ol>
<p>Check on-chain registration status:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- check-committee</span><br></span></code></pre></div></div>
<p>The output shows which members have registered and which are still pending. Wait until all are registered.</p>
<ol start="5">
<li class=""><strong>Notify Phase B (Message creation)</strong></li>
</ol>
<p>Once all members are registered:</p>
<ul>
<li class="">Notify members to begin <strong>Phase B (Message creation)</strong>.</li>
<li class="">Monitor the off-chain storage (e.g. group chat) until all members upload their DKG message files.</li>
</ul>
<ol start="6">
<li class=""><strong>Collect and share DKG messages and notify Phase C (Finalization)</strong></li>
</ol>
<p>Collect message files into a single directory and share it with members. The number of messages must equal exactly the total number of committee members.</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf dkg-messages &amp;&amp; mkdir dkg-messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv path/to/message_0.json dkg-messages/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv path/to/message_1.json dkg-messages/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># repeat until all n members have contributed a message</span><br></span></code></pre></div></div>
<p>Notify members to begin <strong>Phase C (Finalization)</strong>.</p>
<ol start="7">
<li class=""><strong>Confirm committee finalization</strong></li>
</ol>
<p>Monitor on-chain state until all members have proposed and the committee is finalized:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- check-committee</span><br></span></code></pre></div></div>
<p>When finalization completes, the output includes the <code>KEY_SERVER_OBJ_ID</code>. Share this object ID with all members so they can configure their key servers.</p>
<ol start="8">
<li class=""><strong>Collect API keys for <a class="" href="/seal/pr-preview/pr-482/Aggregator">aggregator server</a></strong></li>
</ol>
<p>After all committee members have their key servers running, ask each member to generate API credentials for the aggregator.</p>
<p>Collect and share the following with the aggregator operator:</p>
<ul>
<li class="">API credentials for each committee member, including:<!-- -->
<ul>
<li class="">The on-chain server name (the <code>PartialKeyServer.name</code> field)</li>
<li class="">The API key name</li>
<li class="">The API key</li>
</ul>
</li>
<li class="">The committee&#x27;s <code>KEY_SERVER_OBJ_ID</code> from the previous step.</li>
</ul>
<p>With this information, the aggregator operator can set up the configuration and run the aggregator server. For configuration and startup instructions, see <a class="" href="/seal/pr-preview/pr-482/Aggregator">Aggregator Server</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_V57r" id="fresh-dkg-member-runbook">Fresh DKG member runbook<a href="#fresh-dkg-member-runbook" class="hash-link" aria-label="Direct link to Fresh DKG member runbook" title="Direct link to Fresh DKG member runbook" translate="no">​</a></h3>
<p>Follow these steps to participate as a member in a fresh DKG.</p>
<ol>
<li class=""><strong>Share your address with the coordinator</strong></li>
</ol>
<p>Share your wallet address (<code>MY_ADDRESS</code>) with the coordinator. This address is used for all on-chain actions during the DKG.</p>
<p>Make sure:</p>
<ul>
<li class="">Your wallet is connected to the correct network.</li>
<li class="">You have enough gas to submit transactions.</li>
</ul>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain"># check values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client gas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># switch values if needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client switch --address &lt;MY_ADDRESS&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client switch --env testnet</span><br></span></code></pre></div></div>
<ol start="2">
<li class=""><strong>Generate keys and register (Phase A: Registration)</strong></li>
</ol>
<p>a. Wait for the coordinator to announce <strong>Phase A (Registration)</strong> and send you the <code>dkg.yaml</code> file containing <code>COMMITTEE_PKG</code> and <code>COMMITTEE_ID</code>. Create a local working directory named <code>dkg-state</code> and move the file there:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain"># in seal/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf dkg-state &amp;&amp; mkdir dkg-state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv path/to/dkg.yaml dkg-state/</span><br></span></code></pre></div></div>
<p>b. Look up the committee object ID on a Sui Explorer and verify that its member addresses and threshold match both <code>dkg.yaml</code> and the addresses shared in the trusted communication channel.</p>
<p>c. Then run the command to generate your keys and register them on-chain by providing your server URL and name:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- genkey-and-register \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -u &lt;YOUR_SERVER_URL&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n &lt;YOUR_SERVER_NAME&gt;</span><br></span></code></pre></div></div>
<p>This command:</p>
<ul>
<li class="">Generates DKG key material and stores it in <code>dkg-state/</code>. Keep this directory secure.</li>
<li class="">Appends <code>DKG_ENC_PK</code>, <code>DKG_SIGNING_PK</code>, <code>MY_SERVER_URL</code>, <code>MY_SERVER_NAME</code>, and <code>MY_ADDRESS</code> (from <code>sui client active-address</code>) to <code>dkg.yaml</code>.</li>
<li class="">Registers your public keys on-chain.</li>
</ul>
<ol start="3">
<li class=""><strong>Create and share your DKG message (Phase B: Message creation)</strong></li>
</ol>
<p>a. Wait for the coordinator to announce <strong>Phase B (Message creation)</strong>. Then initialize your local DKG state and generate your message file:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- create-message</span><br></span></code></pre></div></div>
<p>This command outputs a file named <code>dkg-state/message_P.json</code>, where <code>P</code> is your party ID.</p>
<p>b. Share this file with the coordinator.</p>
<ol start="4">
<li class=""><strong>Process messages and propose the committee (Phase C: Finalization)</strong></li>
</ol>
<p>Wait for the coordinator to announce <strong>Phase C (Finalization)</strong> and provide a directory containing messages (for example, <code>path/to/dkg-messages</code>).</p>
<p>Move the directory into <code>dkg-state</code> and process the messages:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">mv path/to/dkg-messages dkg-state/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- process-all-and-propose</span><br></span></code></pre></div></div>
<p>This command:</p>
<ul>
<li class="">Processes all DKG messages from the directory.</li>
<li class="">Appends the following fields to <code>dkg.yaml</code>:<!-- -->
<ul>
<li class=""><code>KEY_SERVER_PK</code>: New key server public key.</li>
<li class=""><code>PARTIAL_PKS_V0</code>: Partial public keys for all members.</li>
<li class=""><code>MASTER_SHARE_V0</code>: Your master share, used to start the key server. Back it up securely and do not share it with anyone.</li>
</ul>
</li>
<li class="">Proposes the committee on-chain by calling the <code>propose</code> function.</li>
</ul>
<ol start="5">
<li class=""><strong>Configure and start your key server</strong></li>
</ol>
<p>a. Wait for the coordinator to confirm that the DKG is complete and share the <code>KEY_SERVER_OBJ_ID</code>.</p>
<p>b. Create a <code>key-server-config.yaml</code> file with your address (<code>MY_ADDRESS</code>) and the key server object ID (<code>KEY_SERVER_OBJ_ID</code>), and set the committee state to active:</p>
<p>Example config file:</p>
<div class="language-yaml codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-yaml codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Committee</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">member_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;MY_ADDRESS&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">key_server_obj_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;KEY_SERVER_OBJ_ID&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">committee_state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Active</span><br></span></code></pre></div></div>
<p>c. Start the key server, setting the config path and your master key share from <code>dkg.yaml</code> (use <code>MASTER_SHARE_V0</code> for a fresh DKG):</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_PATH=crates/key-server/key-server-config.yaml MASTER_SHARE_V0=0x... cargo run --bin key-server</span><br></span></code></pre></div></div>
<p>For infrastructure and deployment recommendations, see <a href="#infrastructure-requirements" class="">Infrastructure requirements</a>.</p>
<ol start="6">
<li class=""><strong>Generate API credentials for the <a class="" href="/seal/pr-preview/pr-482/Aggregator">aggregator</a></strong></li>
</ol>
<p>After your key server is running successfully, generate API credentials for aggregator access and share them with the coordinator.</p>
<ul>
<li class="">Generate an <strong>API key name</strong> and <strong>API key</strong> for your key server.</li>
<li class="">Share the following details with the coordinator:<!-- -->
<ul>
<li class="">Your server name (<code>MY_SERVER_NAME</code> from <code>dkg.yaml</code>, corresponding to the on-chain <code>PartialKeyServer.name</code>)</li>
<li class="">API key name</li>
<li class="">API key</li>
</ul>
</li>
</ul>
<p>The coordinator passes these credentials to the aggregator operator, who uses them to authenticate requests to your key server.</p>
<ol start="7">
<li class=""><strong>Backup and clean up local DKG state</strong></li>
</ol>
<p>Once your key server is running successfully, back up the <code>MASTER_SHARE_V0</code> value. Then you can safely delete the local DKG state directory:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf dkg-state</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_V57r" id="key-rotation-process">Key rotation process<a href="#key-rotation-process" class="hash-link" aria-label="Direct link to Key rotation process" title="Direct link to Key rotation process" translate="no">​</a></h2>
<p>Use key rotation to update the committee membership. When rotating a committee, the set of continuing members, including those present in both the current and next committee, must be large enough to meet the threshold of the current committee.</p>
<p>This guide assumes:</p>
<ul>
<li class="">The current committee version is <code>X</code>, and</li>
<li class="">The rotation produces the next committee version <code>X+1</code>.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_V57r" id="key-rotation-coordinator-runbook">Key rotation coordinator runbook<a href="#key-rotation-coordinator-runbook" class="hash-link" aria-label="Direct link to Key rotation coordinator runbook" title="Direct link to Key rotation coordinator runbook" translate="no">​</a></h3>
<ol>
<li class=""><strong>Prepare DKG configuration</strong></li>
</ol>
<p>a. Make sure your CLI has the expected network and active address with gas.</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># switch if needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client switch --env testnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client switch --address 0x...</span><br></span></code></pre></div></div>
<p>b. Create a clean working directory named <code>dkg-state</code> and copy the rotation example configuration:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain"># in seal/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf dkg-state &amp;&amp; mkdir dkg-state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp crates/seal-committee-cli/dkg-rotation.example.yaml dkg-state/dkg.yaml</span><br></span></code></pre></div></div>
<p>c. Collect the addresses of all members in the <strong>new committee</strong> (including continuing members). Open <code>dkg-state/dkg.yaml</code> and update the following fields.</p>
<p>You can obtain <code>KEY_SERVER_OBJ_ID</code> from the key server configuration of any continuing member in the current committee.</p>
<div class="language-yaml codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-yaml codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">init-params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">NETWORK</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Testnet </span><span class="token comment" style="color:#999988;font-style:italic"># Target network</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">THRESHOLD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Threshold for the new committee (t of n)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">MEMBERS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># New committee members (may include continuing members)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 0x</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 0x</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 0x</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 0x</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Rotation only params</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">init-rotation-params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">KEY_SERVER_OBJ_ID</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0x</span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Key server object ID from the current committee</span><br></span></code></pre></div></div>
<ol start="2">
<li class=""><strong>Initialize the rotation</strong></li>
</ol>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- init-rotation</span><br></span></code></pre></div></div>
<p>This command:</p>
<ul>
<li class="">Fetches the current key server object to determine the existing committee ID and package ID.</li>
<li class="">Initializes the new committee object on-chain.</li>
<li class="">Appends the following fields to the <code>init-rotation</code> section in <code>dkg.yaml</code>:<!-- -->
<ul>
<li class=""><code>COORDINATOR_ADDRESS</code>: Address executing the rotation</li>
<li class=""><code>COMMITTEE_PKG</code>: Package ID of the committee contract</li>
<li class=""><code>CURRENT_COMMITTEE_ID</code>: Current committee object ID</li>
<li class=""><code>COMMITTEE_ID</code>: New committee object ID</li>
</ul>
</li>
</ul>
<ol start="3">
<li class=""><strong>Distribute configuration and notify Phase A (Registration)</strong></li>
</ol>
<p>Share the updated <code>dkg.yaml</code> file with all committee members. Notify members to begin <strong>Phase A (Registration)</strong>.</p>
<ol start="4">
<li class=""><strong>Monitor member registration</strong></li>
</ol>
<p>Check on-chain registration status:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- check-committee</span><br></span></code></pre></div></div>
<p>The output shows which members have registered and which are still pending. Wait until all are registered.</p>
<ol start="5">
<li class=""><strong>Notify Phase B (Message creation)</strong></li>
</ol>
<p>Once all members are registered:</p>
<ul>
<li class="">Notify members to begin <strong>Phase B (Message creation)</strong>.</li>
<li class="">Monitor the off-chain storage (e.g. group chat) until all members upload their DKG message files.</li>
</ul>
<ol start="6">
<li class=""><strong>Collect and share DKG messages and notify Phase C (Finalization)</strong></li>
</ol>
<p>a. Collect message files into a single directory and share it with members. The number of messages must equal exactly the threshold of the current committee.</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf dkg-messages &amp;&amp; mkdir dkg-messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv path/to/message_0.json dkg-messages/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv path/to/message_1.json dkg-messages/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># repeat till the number of messages equals the threshold</span><br></span></code></pre></div></div>
<p>b. Notify members to begin <strong>Phase C (Finalization)</strong>.</p>
<p>c. Remind members that the current committee is at version <code>X</code> (e.g. 0) and it is rotating to target version <code>X+1</code> (e.g. 1). This is used to annotate <code>MASTER_SHARE_VX</code> and <code>MASTER_SHARE_VX+1</code> in the member commands.</p>
<ol start="7">
<li class=""><strong>Confirm committee finalization</strong></li>
</ol>
<p>Monitor on-chain state until all members have proposed and the committee is finalized:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- check-committee</span><br></span></code></pre></div></div>
<ol start="8">
<li class=""><strong>Collect API keys for <a class="" href="/seal/pr-preview/pr-482/Aggregator">aggregator server</a></strong></li>
</ol>
<p>If new members join the committee during rotation or existing members change API credentials, ask each member to send API credentials for the aggregator.</p>
<p>Collect and share the following with the aggregator operator:</p>
<ul>
<li class="">API credentials for each committee member, including:<!-- -->
<ul>
<li class="">The on-chain server name (the <code>PartialKeyServer.name</code> field)</li>
<li class="">The API key name</li>
<li class="">The API key</li>
</ul>
</li>
</ul>
<p>With this information, the aggregator operator can update the configuration and run the aggregator server. For configuration and startup instructions, see <a class="" href="/seal/pr-preview/pr-482/Aggregator">Aggregator Server</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_V57r" id="key-rotation-member-runbook">Key rotation member runbook<a href="#key-rotation-member-runbook" class="hash-link" aria-label="Direct link to Key rotation member runbook" title="Direct link to Key rotation member runbook" translate="no">​</a></h3>
<p>Follow these steps to participate as a member in a key rotation.</p>
<ol>
<li class=""><strong>Share your address with the coordinator</strong></li>
</ol>
<p>Share your wallet address (<code>MY_ADDRESS</code>) with the coordinator. This address is used for all on-chain actions during the rotation.</p>
<p>Make sure:</p>
<ul>
<li class="">Your wallet is connected to the correct network.</li>
<li class="">You have enough gas to submit transactions.</li>
</ul>
<ol start="2">
<li class=""><strong>Generate keys and register (Phase A: Registration)</strong></li>
</ol>
<p>a. Wait for the coordinator to announce <strong>Phase A (Registration)</strong> and send you the <code>dkg.yaml</code> file. The file includes <code>COMMITTEE_PKG</code>, <code>CURRENT_COMMITTEE_ID</code>, and <code>COMMITTEE_ID</code>. Create a local working directory named <code>dkg-state</code> and move the file there:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain"># in seal/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf dkg-state &amp;&amp; mkdir dkg-state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv path/to/dkg.yaml dkg-state/</span><br></span></code></pre></div></div>
<p>b. Look up the committee object ID on a Sui Explorer and verify that its member addresses and threshold match both <code>dkg.yaml</code> and the addresses shared in the trusted communication channel.</p>
<p>c. Then run the command to generate your keys and register them on-chain by providing your server URL and name:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- genkey-and-register \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -u &lt;YOUR_SERVER_URL&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n &lt;YOUR_SERVER_NAME&gt;</span><br></span></code></pre></div></div>
<p>This command:</p>
<ul>
<li class="">Generates sensitive key material and stores it in <code>dkg-state/</code>. Keep this directory secure.</li>
<li class="">Appends <code>DKG_ENC_PK</code>, <code>DKG_SIGNING_PK</code>, <code>MY_SERVER_URL</code>, <code>MY_SERVER_NAME</code>, and <code>MY_ADDRESS</code> (from <code>sui client active-address</code>) to <code>dkg.yaml</code>.</li>
<li class="">Registers your public keys on-chain.</li>
</ul>
<ol start="3">
<li class=""><strong>Create and share your DKG message (Phase B: Message creation)</strong></li>
</ol>
<p>Wait for the coordinator to announce <strong>Phase B (Message creation)</strong>.</p>
<p><strong>For continuing members</strong>:</p>
<p>a. Initialize your DKG state and generate your message file. You must pass your current master share (<code>MASTER_SHARE_VX</code>). This is the master share environment variable value that your key server is currently running with.</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- create-message -o &lt;MASTER_SHARE_VX&gt;</span><br></span></code></pre></div></div>
<p>This command outputs <code>dkg-state/message_P.json</code>, where <code>P</code> is your party ID.</p>
<p>b. Share this file with the coordinator.</p>
<p><strong>For new members</strong>:</p>
<p>Initialize your DKG state. No message file is generated (new members don&#x27;t create messages during rotation).</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- init-state</span><br></span></code></pre></div></div>
<ol start="4">
<li class=""><strong>Process messages and propose the rotation (Phase C: Finalization)</strong></li>
</ol>
<p>Wait for the coordinator to announce <strong>Phase C (Finalization)</strong> and provide a directory containing all DKG messages (for example, <code>path/to/dkg-messages</code>).</p>
<p>Move the directory into <code>dkg-state</code> and process the messages:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">mv path/to/dkg-messages dkg-state/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- process-all-and-propose</span><br></span></code></pre></div></div>
<p>This command:</p>
<ul>
<li class="">Processes all messages from the directory.</li>
<li class="">Appends the following fields to <code>dkg.yaml</code>:<!-- -->
<ul>
<li class=""><code>PARTIAL_PKS_VX+1</code>: New partial public keys for all members.</li>
<li class=""><code>MASTER_SHARE_VX+1</code>: Your new master share, used to start the key server. Back it up securely and do not share it with anyone.</li>
</ul>
</li>
<li class="">Proposes the rotation on-chain by calling <code>propose_for_rotation</code>.</li>
</ul>
<ol start="5">
<li class=""><strong>Start or update your key server</strong></li>
</ol>
<p><strong>For continuing members:</strong>
a. Update <code>key-server-config.yaml</code></p>
<ul>
<li class="">Change the committee state from <em>Active</em> to <strong>Rotation</strong> mode.</li>
<li class="">Set the target committee version to <code>X+1</code> (increment 1 from the current version <code>X</code>). If you are not sure what <code>X</code> is in this rotation, check with your coordinator.</li>
<li class="">Leave other settings unchanged.</li>
</ul>
<p>Example config file:</p>
<div class="language-yaml codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-yaml codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Committee</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">member_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;MY_ADDRESS&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">key_server_obj_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;KEY_SERVER_OBJ_ID&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">committee_state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Rotation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target_version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;X+1</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Increment this</span><br></span></code></pre></div></div>
<p>b. Restart the key server with both the old and new master shares (<code>MASTER_SHARE_VX</code> corresponds to the current committee version <code>X</code> and <code>MASTER_SHARE_VX+1</code> corresponds to the next committee version <code>X+1</code>). The server monitors on-chain state and selects the correct share automatically.</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_PATH=crates/key-server/key-server-config.yaml \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MASTER_SHARE_VX=&lt;MASTER_SHARE_VX&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MASTER_SHARE_VX+1=&lt;MASTER_SHARE_VX+1&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cargo run --bin key-server</span><br></span></code></pre></div></div>
<p>c. Wait for the coordinator to confirm that rotation is complete. Then update the config to <strong>Active</strong> mode and restart the server with only the new master share.</p>
<p>Example config file:</p>
<div class="language-yaml codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-yaml codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Committee</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">member_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;MY_ADDRESS&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">key_server_obj_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;KEY_SERVER_OBJ_ID&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">committee_state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Active</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_PATH=crates/key-server/key-server-config.yaml \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MASTER_SHARE_VX+1=&lt;MASTER_SHARE_VX+1&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cargo run --bin key-server</span><br></span></code></pre></div></div>
<p><strong>For new members:</strong></p>
<p>a. Create <code>key-server-config.yaml</code>. Since <code>X+1</code> is your first committee version, start the key server directly in <strong>Active</strong> mode.</p>
<p>Example config file:</p>
<div class="language-yaml codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-yaml codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Committee</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">member_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;MY_ADDRESS&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">key_server_obj_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;KEY_SERVER_OBJ_ID&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">committee_state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token tag" style="color:#00009f">!Active</span><br></span></code></pre></div></div>
<p>b. Start the key server with the new master share <code>MASTER_SHARE_VX+1</code> that corresponds to the new committee version <code>X+1</code>.</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_PATH=crates/key-server/key-server-config.yaml \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MASTER_SHARE_VX+1=&lt;MASTER_SHARE_VX+1&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cargo run --bin key-server</span><br></span></code></pre></div></div>
<p>For infrastructure and deployment recommendations, see <a href="#infrastructure-requirements" class="">Infrastructure requirements</a>.</p>
<ol start="6">
<li class=""><strong>Generate API credentials for the <a class="" href="/seal/pr-preview/pr-482/Aggregator">aggregator</a> (new members only)</strong></li>
</ol>
<p>If you are joining the committee as a new member during rotation, generate API credentials after your key server is up and running and share them with the coordinator.</p>
<p>a. Generate an <strong>API key name</strong> and <strong>API key</strong> for your key server.
b. Share the following with the coordinator:</p>
<ul>
<li class="">Your server name (<code>MY_SERVER_NAME</code> from <code>dkg.yaml</code>, corresponding to the on-chain <code>PartialKeyServer.name</code>)</li>
<li class="">API key name</li>
<li class="">API key</li>
</ul>
<p>The coordinator passes these credentials to the aggregator operator, who uses them to authenticate requests to your key server.</p>
<div class="theme-admonition theme-admonition-note admonition_qNOj alert alert--secondary"><div class="admonitionHeading_tudc"><span class="admonitionIcon_OTUU"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_lznt"><p>Continuing members typically do not need to share new credentials, since their existing API keys should already be configured in the aggregator. Share new credentials only if you are rotating your API keys.</p></div></div>
<ol start="7">
<li class=""><strong>Backup and clean up local DKG state</strong></li>
</ol>
<p>Once your key server is running successfully, back up the <code>MASTER_SHARE_VX+1</code> value. Then you can safely delete the local DKG state directory:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf dkg-state</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_V57r" id="package-upgrade">Package Upgrade<a href="#package-upgrade" class="hash-link" aria-label="Direct link to Package Upgrade" title="Direct link to Package Upgrade" translate="no">​</a></h2>
<p>The committee can upgrade the <code>seal_committee</code> Move package through a voting process. A contract upgrade can only happen if a threshold of committee members approves the new package digest.</p>
<p>The upgrade follows these steps:</p>
<ol>
<li class=""><strong>Compute package digest</strong>: Build the updated package and extract its digest.</li>
<li class=""><strong>Committee voting</strong>: Committee members vote for the new package digest.</li>
<li class=""><strong>Execute the upgrade</strong>: Once threshold is reached, authorize, execute and commit the upgrade.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_V57r" id="prerequisites-1">Prerequisites<a href="#prerequisites-1" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h3>
<ol>
<li class="">Make sure you are on the expected network.</li>
<li class="">Make sure you are using the same address as the one you used to participate in the current active committee.</li>
<li class=""><code>&lt;KEY_SERVER_OBJ_ID&gt;</code> can be found in your server&#x27;s config file <code>key-server-config.yaml</code>.</li>
</ol>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sui client active-address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify the current key server status and its committee members (that contains your address).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- check-key-server-status \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -k &lt;KEY_SERVER_OBJ_ID&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n &lt;NETWORK&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_V57r" id="steps">Steps<a href="#steps" class="hash-link" aria-label="Direct link to Steps" title="Direct link to Steps" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_V57r" id="1-compute-the-package-digest">1. Compute the package digest<a href="#1-compute-the-package-digest" class="hash-link" aria-label="Direct link to 1. Compute the package digest" title="Direct link to 1. Compute the package digest" translate="no">​</a></h4>
<p>Pull the updated package code locally and verify updates. This command computes the package digest for the committee package (<code>move/committee</code>). Make sure that all committee members have the same digest and are ready for upgrade.</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain"># in seal/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- package-digest -n &lt;NETWORK&gt;</span><br></span></code></pre></div></div>
<p>This outputs:</p>
<div class="language-text codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-text codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">Digest for package &#x27;committee&#x27;: 0xd0f13987e824f0f462911bc45d5a45004f4e3d752de2be939111274e862cc00c</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_V57r" id="2-approve-the-upgrade">2. Approve the upgrade<a href="#2-approve-the-upgrade" class="hash-link" aria-label="Direct link to 2. Approve the upgrade" title="Direct link to 2. Approve the upgrade" translate="no">​</a></h4>
<p>Each committee member approves for the upgrade using the locally built package, run:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- approve-upgrade \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -k &lt;KEY_SERVER_OBJ_ID&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n &lt;NETWORK&gt;</span><br></span></code></pre></div></div>
<p><strong>Notes:</strong></p>
<ol>
<li class="">To check the current upgrade proposal status (digest, votes, threshold), run:</li>
</ol>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- check-key-server-status \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -k &lt;KEY_SERVER_OBJ_ID&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n &lt;NETWORK&gt;</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">If needed, the local package is not what you want to approve, run this to reject it onchain.</li>
</ol>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- reject-upgrade \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p &lt;PACKAGE_PATH&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -k &lt;KEY_SERVER_OBJ_ID&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n &lt;NETWORK&gt;</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">
<p>If needed, can run <code>approve-upgrade</code> or <code>reject-upgrade</code> again to change your vote option.</p>
</li>
<li class="">
<p>If needed, if a threshold of committee members reject the upgrade, any member can reset the proposal to allow a new upgrade proposal.</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- reset-proposal \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -k &lt;KEY_SERVER_OBJ_ID&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n &lt;NETWORK&gt;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_V57r" id="3-authorize-execute-and-commit-the-upgrade">3. Authorize, execute and commit the upgrade<a href="#3-authorize-execute-and-commit-the-upgrade" class="hash-link" aria-label="Direct link to 3. Authorize, execute and commit the upgrade" title="Direct link to 3. Authorize, execute and commit the upgrade" translate="no">​</a></h4>
<p>Once the threshold number of committee members approves the digest, any member run this to execute the upgrade:</p>
<div class="language-bash codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-bash codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin seal-committee-cli -- authorize-and-upgrade \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -k &lt;KEY_SERVER_OBJ_ID&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n &lt;NETWORK&gt;</span><br></span></code></pre></div></div>
<p>This command:</p>
<ul>
<li class="">Authorizes the upgrade (gets an UpgradeTicket).</li>
<li class="">Performs the package upgrade with the ticket (gets an UpgradeReceipt).</li>
<li class="">Commits the upgrade receipt.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_V57r" id="quick-reference-fresh-dkg-vs-key-rotation">Quick reference: Fresh DKG vs Key rotation<a href="#quick-reference-fresh-dkg-vs-key-rotation" class="hash-link" aria-label="Direct link to Quick reference: Fresh DKG vs Key rotation" title="Direct link to Quick reference: Fresh DKG vs Key rotation" translate="no">​</a></h2>
<table><thead><tr><th>Aspect</th><th>Fresh DKG</th><th>Key rotation</th></tr></thead><tbody><tr><td>Purpose</td><td>Create a brand-new committee and keys</td><td>Update committee membership or threshold</td></tr><tr><td>Committee version</td><td>Starts at <code>V0</code></td><td>Rotates from <code>VX</code> to <code>VX+1</code></td></tr><tr><td>Coordinator init command</td><td><code>publish-and-init</code></td><td><code>init-rotation</code></td></tr><tr><td>Continuing members required</td><td>N/A</td><td>Must meet current threshold</td></tr><tr><td>Member Phase B command</td><td>All members: <code>create-message</code></td><td>Continuing members: <code>create-message -o &lt;OLD_SHARE&gt;</code><br>New members: <code>init-state</code></td></tr><tr><td>Old master share needed</td><td>N/A</td><td>Yes (continuing members must provide via <code>-o</code> flag)</td></tr><tr><td>Message creation</td><td>All members create messages</td><td>Only continuing members create messages</td></tr><tr><td>Key server startup</td><td>Start with <code>MASTER_SHARE_V0</code></td><td>Transition from <code>MASTER_SHARE_VX</code> to <code>MASTER_SHARE_VX+1</code></td></tr><tr><td>on-chain proposal function</td><td><code>propose</code></td><td><code>propose_for_rotation</code></td></tr><tr><td>Result</td><td>New key server object</td><td>Updated key server object&#x27;s version</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_V57r" id="infrastructure-requirements">Infrastructure requirements<a href="#infrastructure-requirements" class="hash-link" aria-label="Direct link to Infrastructure requirements" title="Direct link to Infrastructure requirements" translate="no">​</a></h2>
<p>The committee type server is initialized with a master share generated during the DKG ceremony, which must be kept secure. You can store it using a cloud-based Key Management System (KMS), or in a self-managed software or hardware vault.</p>
<p>The server is a lightweight, stateless service designed for easy horizontal scaling. Because it doesn&#x27;t require persistent storage, you can run multiple instances behind a load balancer to increase availability and resilience. Each instance must have access to a trusted <a href="https://docs.sui.io/guides/operator/sui-full-node" target="_blank" rel="noopener noreferrer" class="">Sui full node</a> — ideally one that&#x27;s geographically close to reduce latency during policy checks and key operations.</p>
<p>To operate the server securely, it is recommended to place it behind an API gateway or reverse proxy. This allows you to:</p>
<ul>
<li class="">Expose the service over HTTPS and terminate SSL/TLS at the edge</li>
<li class="">Enforce rate limiting and prevent abuse</li>
<li class="">Authenticate requests using API keys or access tokens</li>
<li class="">Optionally integrate usage tracking for commercial or billable offerings, such as logging access frequency per client or package</li>
</ul>
<p>For observability, the server exposes Prometheus-compatible metrics on port <code>9184</code>. You can access raw metrics by running <code>curl http://0.0.0.0:9184</code>. These metrics can also be visualized using tools like Grafana. The key server also includes a basic health check endpoint on port <code>2024</code>: <code>curl http://0.0.0.0:2024/health</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_V57r" id="cors-configuration">CORS configuration<a href="#cors-configuration" class="hash-link" aria-label="Direct link to CORS configuration" title="Direct link to CORS configuration" translate="no">​</a></h3>
<p>Configure Cross-Origin Resource Sharing (CORS) on your server to allow applications to make requests directly from the browser. Use the following recommended headers:</p>
<div class="language-shell codeBlockContainer_vISq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AhnU"><pre tabindex="0" class="prism-code language-shell codeBlock_lwkX thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_pwDh"><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Allow-Origin: *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Allow-Methods: GET, POST, OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Allow-Headers: Request-Id, Client-Sdk-Type, Client-Sdk-Version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access-Control-Expose-Headers: x-keyserver-version</span><br></span></code></pre></div></div>
<p>If your server requires an API key, make sure to include the corresponding HTTP header name in <code>Access-Control-Allow-Headers</code> as well.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/seal/pr-preview/pr-482/KeyServerOps"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Key Server Operations for Independent Server Type</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/seal/pr-preview/pr-482/Aggregator"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Aggregator Server</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_tmgb thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#fresh-dkg-process" class="table-of-contents__link toc-highlight">Fresh DKG process</a><ul><li><a href="#fresh-dkg-coordinator-runbook" class="table-of-contents__link toc-highlight">Fresh DKG coordinator runbook</a></li><li><a href="#fresh-dkg-member-runbook" class="table-of-contents__link toc-highlight">Fresh DKG member runbook</a></li></ul></li><li><a href="#key-rotation-process" class="table-of-contents__link toc-highlight">Key rotation process</a><ul><li><a href="#key-rotation-coordinator-runbook" class="table-of-contents__link toc-highlight">Key rotation coordinator runbook</a></li><li><a href="#key-rotation-member-runbook" class="table-of-contents__link toc-highlight">Key rotation member runbook</a></li></ul></li><li><a href="#package-upgrade" class="table-of-contents__link toc-highlight">Package Upgrade</a><ul><li><a href="#prerequisites-1" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#steps" class="table-of-contents__link toc-highlight">Steps</a></li></ul></li><li><a href="#quick-reference-fresh-dkg-vs-key-rotation" class="table-of-contents__link toc-highlight">Quick reference: Fresh DKG vs Key rotation</a></li><li><a href="#infrastructure-requirements" class="table-of-contents__link toc-highlight">Infrastructure requirements</a><ul><li><a href="#cors-configuration" class="table-of-contents__link toc-highlight">CORS configuration</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>